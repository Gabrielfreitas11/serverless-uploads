{"version":3,"file":"src/controllers/productsByEAN/index.js","mappings":"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","sources":["webpack://node/webpack/bootstrap","webpack://node/webpack/runtime/compat get default export","webpack://node/webpack/runtime/define property getters","webpack://node/webpack/runtime/hasOwnProperty shorthand","webpack://node/webpack/runtime/make namespace object","webpack://node/external commonjs \"@babel/runtime/helpers/asyncToGenerator\"","webpack://node/./common/httpResponse.js","webpack://node/external commonjs \"@babel/runtime/helpers/defineProperty\"","webpack://node/./common/handler/BaseController.js","webpack://node/./common/handler/handle.js","webpack://node/external commonjs \"@hapi/joi\"","webpack://node/./src/controllers/productsByEAN/validations/schema.js","webpack://node/external commonjs \"openai\"","webpack://node/external commonjs \"cheerio\"","webpack://node/external commonjs \"axios\"","webpack://node/./common/http.js","webpack://node/./src/clients/fetchBrowser.js","webpack://node/./common/convertHtmlToText.js","webpack://node/./src/controllers/productsByEAN/functions/getMessage.js","webpack://node/./src/controllers/productsByEAN/index.js","webpack://node/./src/controllers/productsByEAN/validations/validator.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/asyncToGenerator\");","export default class HttpResponse {\r\n  static ok(body) {\r\n    return {\r\n      statusCode: 200,\r\n      body,\r\n    };\r\n  }\r\n\r\n  static created(body) {\r\n    return {\r\n      statusCode: 201,\r\n      body,\r\n    };\r\n  }\r\n\r\n  static notFound(body) {\r\n    return {\r\n      statusCode: 404,\r\n      body,\r\n    };\r\n  }\r\n\r\n  static badRequest(body) {\r\n    return {\r\n      statusCode: 400,\r\n      body,\r\n    };\r\n  }\r\n\r\n  static serverError(body) {\r\n    return {\r\n      statusCode: 500,\r\n      body,\r\n    };\r\n  }\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","export default class BaseController {\n  event = null;\n\n  context = null;\n\n  env = process.env;\n\n  async handle(event, context, method, isHttpResponse = true) {\n    this.setFunctionContext(event, context);\n\n    if (!(await this.isAuthorized())) {\n      return BaseController.httpResponse(\n        401,\n        JSON.stringify({\n          statusCode: 401,\n          message: 'Unauthorized!',\n        }),\n      );\n    }\n\n    try {\n      const response = await this[method](event);\n\n      if (!isHttpResponse) return response;\n\n      const body = typeof response.body === 'string'\n        ? response.body\n        : JSON.stringify(response.body);\n      return BaseController.httpResponse(\n        response.statusCode,\n        body,\n        response.headers,\n      );\n    } catch (err) {\n      const message = err.response && err.response.data\n        ? err.response.data\n        : err.message || err;\n\n      return BaseController.httpResponse(500, message);\n    }\n  }\n\n  setFunctionContext(event, context) {\n    this.event = event;\n    this.context = context;\n\n    process.env.sourceIpAddress = event.requestContext\n      && event.requestContext.identity\n      && event.requestContext.identity.sourceIp\n      ? event.requestContext.identity.sourceIp\n      : null;\n  }\n\n  static httpResponse(statusCode, body, headers = {}) {\n    return {\n      statusCode,\n      body,\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': '*',\n        ...headers,\n      },\n    };\n  }\n\n  isAuthorized() {\n    const checkByAuthMethod = {\n      header: this.authHeaderIsTheSameInTheEnvironment(),\n    }[this.env.authMethod];\n\n    if (checkByAuthMethod === undefined) {\n      return true;\n    }\n\n    return checkByAuthMethod;\n  }\n\n  authHeaderIsTheSameInTheEnvironment() {\n    return this.event.headers.Authorization === this.env.authToken;\n  }\n\n  /**\n   * @author Victor Hugo Lemos Mattar & Sandrão\n   * @param {*} context\n   * @returns {string}\n   */\n\n  /**\n   * @author Will Saymon & Victor Hugo Lemos Mattar\n   * @param {*} context\n   * @returns {string}\n   */\n}\n","import BaseController from './BaseController';\n\nexport default async (event, context, func, funcName) => {\n  const Controller = class extends BaseController {};\n  const handler = new Controller();\n  handler[funcName] = func;\n  return handler.handle(event, context, funcName);\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@hapi/joi\");","import Joi from '@hapi/joi';\n\nexport const schema = Joi.object({\n  product: Joi.string().required(),\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"openai\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"cheerio\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"axios\");","import axios from 'axios';\n\nexport async function request(options, optionsHttpsAgent = null) {\n  const optionsAxios = optionsHttpsAgent && optionsHttpsAgent.httpsAgent\n    ? optionsHttpsAgent\n    : options;\n\n  return axios(optionsAxios).then(\n    async (response) => response,\n    async (error) => {\n      throw error;\n    },\n  );\n}\n","// import { request } from \"../../common/http\";\n\nimport { convertHtmlToText } from '../../common/convertHtmlToText';\nimport { request } from '../../common/http';\n\nconst fetchBrowser = async (content, attempts = 0) => {\n  try {\n    const url = `https://pt.product-search.net/?q=${content}`;\n\n    const options = {\n      url,\n      method: 'GET',\n      headers: {\n        'Content-Type': 'text/html',\n        'Access-Control-Allow-Origin': '*',\n      },\n    };\n\n    const response = await request(options);\n\n    const $ = convertHtmlToText(response.data);\n\n    console.log($('p').text());\n    console.log($('tbody').text());\n\n    const infoProducts = $('p').text().split('EAN');\n\n    // console.log(infoProducts);\n    let product = '';\n\n    infoProducts.forEach((el) => {\n      if (el.includes(content)) {\n        product = el.replace(content, '');\n      }\n    });\n\n    return product.trim();\n  } catch (e) {\n    console.log(e);\n    // const $ = convertHtmlToText(e?.response?.data);\n\n    // if ($('title').text().includes('403') && attempts < 6) {\n    //   console.log(attempts);\n    //   await new Promise((resolve) => setTimeout(resolve, 2000));\n    //   const product = await fetchBrowser(content, attempts + 1);\n\n    //   return product;\n    // }\n\n    throw null;\n  }\n};\n\nexport { fetchBrowser };\n","import { load } from 'cheerio';\n\nexport function convertHtmlToText(html) {\n  return load(html);\n}\n","import { chatGPT } from '../../../clients/chatGPT';\n\nimport { fetchBrowser } from '../../../clients/fetchBrowser';\n\nexport async function getMessage({ product }) {\n  const response = await fetchBrowser(product);\n\n  // const message = await chatGPT(product, EAN);\n\n  return response;\n}\n","import HttpResponse from '../../../common/httpResponse';\n\nimport handleFunction from '../../../common/handler/handle';\n\nimport { isValidParams } from './validations/validator';\n\nimport { getMessage } from './functions/getMessage';\n\nexport const productsByEAN = async ({ body }) => {\n  try {\n    console.log(body);\n    const params = isValidParams(JSON.parse(body));\n\n    if (params.error) {\n      return HttpResponse.badRequest({\n        message: params.message,\n      });\n    }\n\n    const message = await getMessage(params.value);\n\n    return HttpResponse.ok({\n      message,\n    });\n  } catch (error) {\n    // console.log(error);\n\n    return HttpResponse.serverError({\n      message: error?.message || 'Problemas ao consultar mensagem',\n    });\n  }\n};\n\nexport const handle = async (event, context) => handleFunction(event, context, productsByEAN, 'productsByEAN');\n","import { schema } from './schema';\r\n\r\nexport function isValidParams(params) {\r\n  if (!params) {\r\n    return {\r\n      error: true,\r\n      message: 'Faltando parâmetros obrigatórios',\r\n    };\r\n  }\r\n\r\n  const result = schema.validate(params);\r\n  if (result.error) {\r\n    return {\r\n      error: true,\r\n      message: `O seguinte parâmetro está faltando ou incorreto: ${result.error.details[0].path[0]}`,\r\n    };\r\n  }\r\n\r\n  return {\r\n    value: result.value,\r\n    error: false,\r\n  };\r\n}\r\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","require","HttpResponse","static","body","statusCode","BaseController","constructor","event","context","env","process","handle","method","_arguments","arguments","_this","_asyncToGenerator","isHttpResponse","length","undefined","setFunctionContext","isAuthorized","httpResponse","JSON","stringify","message","response","headers","err","data","this","sourceIpAddress","requestContext","identity","sourceIp","_objectSpread","checkByAuthMethod","header","authHeaderIsTheSameInTheEnvironment","authMethod","Authorization","authToken","_ref","func","funcName","handler","_x","_x2","_x3","_x4","apply","schema","Joi","product","required","_request","options","optionsHttpsAgent","optionsAxios","httpsAgent","axios","then","_ref2","error","fetchBrowser","content","html","url","concat","request","$","load","console","log","text","infoProducts","split","forEach","el","includes","replace","trim","e","_getMessage","productsByEAN","params","result","validate","details","path","isValidParams","parse","badRequest","getMessage","ok","serverError","_ref3","handleFunction"],"sourceRoot":""}